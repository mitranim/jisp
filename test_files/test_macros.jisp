[.use `jisp:prelude.mjs` *]

; FIXME must be compile error due to cyclic dependency.
; [.use `./test_code.jisp` *]

; "global" must be declared in prelude.
[const g global]

; FIXME implement.
; FIXME exclude from compiled code, unless used by non-macros.
[fn astMacro []
  ; Masking must work.
  [const g global]
  [g.console.log `executing AST macro`]

  ; FIXME implement.
  ; FIXME compile error for unknown identifier "one" and others.
  ; [quote [one two three]]
]

[callSyntax `list macro call ast` astMacro]

; FIXME must be compile error.
astMacro

; Must be compile error if enabled.
; [astMacro 10 20 30]

[fn valMacro []
  ; Masking must work.
  [const g global]
  [g.console.log `executing val macro`]

  [g.Array.of
    10
    [g.Object.fromEntries
      [g.Array.of
        [g.Array.of `one` 20]
        [g.Array.of `ðŸ™‚ðŸ˜›ðŸ˜ž` 30]
      ]
    ]
  ]
]

; TODO consider: get "Decl" and call its method.
[callSyntax `list macro call val` valMacro]

; FIXME must be compile error.
valMacro

; Must be compile error if enabled.
; [valMacro 10 20 30]
